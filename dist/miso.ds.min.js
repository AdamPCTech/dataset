/**
* Miso.Dataset - v0.1.0 - 3/1/2012
* http://github.com/alexgraul/Dataset
* Copyright (c) 2012 Alex Graul, Irene Ros;
* Licensed MIT, GPL
*/
(function(a,_){var b=a.Miso={};b.typeOf=function(a,c){var d=_.keys(b.types),e;return d.push(d.splice(_.indexOf(d,"string"),1)[0]),e=_.find(d,function(d){return b.types[d].test(a,c)}),e=_.isUndefined(e)?"string":e,e},b.types={string:{name:"string",coerce:function(a){return _.isNull(a)?null:a.toString()},test:function(a){return typeof a=="string"},compare:function(a,b){return a<b?-1:a>b?1:0},numeric:function(a,b){return b}},"boolean":{name:"boolean",regexp:/^(true|false)$/,coerce:function(a){return a==="false"?!1:Boolean(a)},test:function(a){return typeof a=="boolean"||this.regexp.test(a)?!0:!1},compare:function(a,b){return a===b?0:a<b?-1:1},numeric:function(a){return a?1:0}},number:{name:"number",regexp:/^[\-\.]?[0-9]+([\.][0-9]+)?$/,coerce:function(a){return _.isNull(a)?null:(a=Number(a),_.isNaN(a)?null:a)},test:function(a){return typeof a=="number"||this.regexp.test(a)?!0:!1},compare:function(a,b){return a===b?0:a<b?-1:1},numeric:function(a){return a}},time:{name:"time",format:"DD/MM/YYYY",_formatLookup:[["DD","\\d{2}"],["MM","\\d{2}"],["YYYY","\\d{4}"],["YY","\\d{2}"]],_regexpTable:{},_regexp:function(a){if(this._regexpTable[a])return new RegExp(this._regexpTable[a],"g");var b=a;return _.each(this._formatLookup,function(a){b=b.replace(a[0],a[1])},this),b=b.split("/").join("\\/"),this._regexpTable[a]=b,new RegExp(this._regexpTable[a],"g")},coerce:function(a,b){b=b||{};if(_.isString(a)){var c=b.format||this.format;return moment(a,b.format)}return _.isNumber(a)?moment(a):a},test:function(a,b){b=b||{};if(_.isString(a)){var c=b.format||this.format,d=this._regexp(c);return d.test(a)}return!0},compare:function(a,b){return a<b?-1:a>b?1:0},numeric:function(a){return a.valueOf()}}}})(this,_),function(a,_){var b=a.Miso||(a.Miso={});b.Event=function(a){_.isArray(a)||(a=[a]),this.deltas=a},_.extend(b.Event.prototype,{affectedColumns:function(){var a=[];return _.each(this.deltas,function(b){a=_.union(a,_.keys(b.old),_.keys(b.changed))}),a}}),_.extend(b.Event,{isDelete:function(a){return _.isUndefined(a.changed)||_.keys(a.changed).length===0?!0:!1},isAdd:function(a){return _.isUndefined(a.old)||_.keys(a.old).length===0?!0:!1},isUpdate:function(a){return!this.isDelete(a)&&!this.isAdd(a)?!0:!1}}),b.Events={},b.Events.bind=function(a,b,c){var d=this._callbacks||(this._callbacks={}),e=d[a]||(d[a]={}),f=e.tail||(e.tail=e.next={});return f.callback=b,f.context=c,e.tail=f.next={},this},b.Events.unbind=function(a,b){var c,d,e;if(!a)this._callbacks=null;else if(c=this._callbacks)if(!b)c[a]={};else if(d=c[a])while((e=d)&&(d=d.next)){if(d.callback!==b)continue;e.next=d.next,d.context=d.callback=null;break}return this},b.Events.trigger=function(a){var b,c,d,e,f,g=["all",a];if(!(c=this._callbacks))return this;while(f=g.pop()){if(!(b=c[f]))continue;e=f==="all"?arguments:Array.prototype.slice.call(arguments,1);while(b=b.next)(d=b.callback)&&d.apply(b.context||this,e)}return this},b.Events._buildEvent=function(a){return new b.Event(a)}}(this,_),function(a,_){var b=a.Miso;b.Column=function(a){return this._id=a.id||_.uniqueId(),this.name=a.name,this.type=a.type,this.data=a.data||[],this},_.extend(b.Column.prototype,{toNumeric:function(a,c){return b.types[this.type].numeric(a,c)},numericAt:function(a){return this.toNumeric(this.data[a],a)},coerce:function(){this.data=_.map(this.data,function(a){return b.types[this.type].coerce(a,this.typeOptions)},this)},sum:function(){return _.sum(this.data)},mean:function(){return _.mean(this.data)},median:function(){return _.median(this.data)},max:function(){var a=-Infinity;for(var c=0;c<this.data.length;c++)b.types[this.type].compare(this.data[c],a)>0&&(a=this.numericAt(c));return a},min:function(){var a=Infinity;for(var c=0;c<this.data.length;c++)b.types[this.type].compare(this.data[c],a)<0&&(a=this.numericAt(c));return a}}),b.View=function(a){a=a||(a={});if(_.isUndefined(a.parent))throw new Error("A view must have a parent specified.");return this.parent=a.parent,this._initialize(a),this},_.extend(b.View.prototype,{_initialize:function(a){this.parent.syncable===!0&&(_.extend(this,b.Events),this.syncable=!0),this.filter={columns:this._columnFilter(a.filter.columns||undefined),rows:this._rowFilter(a.filter.rows||undefined)},this._columns=this._selectData();var c=new b.Parsers;_.extend(this,c._cacheColumns(this),c._cacheRows(this)),this.syncable&&this.parent.bind("change",this.sync,this)},sync:function(a){var c=a.deltas;_.each(c,function(c,d){var e=this._rowPositionById[c._id];if(typeof e=="undefined"&&b.Event.isAdd(c))this.filter.rows&&this.filter.rows(c.changed)&&this._add(c.changed);else{if(e==="undefined")return;_.each(c.changed,function(a,b){var c=this._columnPositionByName[b];if(_.isUndefined(c))return;this._columns[c].data[e]=a},this)}var f=this.rowByPosition(e);if(b.Event.isDelete(c)||this.filter.row&&!this.filter.row(f)){var g={_id:c._id,old:this.rowByPosition(e),changed:{}};a.deltas.splice(d,1,g),this._remove(e)}},this),this.syncable&&this.trigger("change",a)},where:function(a,c){return c=c||{},c.parent=this,c.filter=a||{},new b.View(c)},_selectData:function(){var a=[];return _.each(this.parent._columns,function(b){this.filter.columns(b)&&a.push({name:b.name,data:[],type:b.type,_id:b._id})},this),this.parent.each(function(b){if(!this.filter.rows(b))return;for(var c=0;c<a.length;c++)a[c].data.push(b[a[c].name])},this),a},_columnFilter:function(a){var b;return _.isUndefined(a)?b=function(){return!0}:(a.push("_id"),b=function(b){return _.indexOf(a,b.name)===-1?!1:!0}),b},_rowFilter:function(a){var b;return _.isNumber(a)&&(a=[a]),_.isUndefined(a)?b=function(){return!0}:_.isFunction(a)?b=a:b=function(b){return _.indexOf(a,b._id)===-1?!1:!0},b},column:function(a){return this._column(a)},_column:function(a){var b=this._columnPositionByName[a];return this._columns[b]},columns:function(a){return new b.View({filter:{columns:a},parent:this})},columnNames:function(){var a=_.pluck(this._columns,"name");return a.shift(),a},each:function(a,b){for(var c=0;c<this.length;c++)a.apply(b||this,[this.rowByPosition(c),c])},eachColumn:function(a,b){for(var c=1;c<this.length;c++)a.apply(b||this,[this._columns[c].name,c])},rowByPosition:function(a){return this._row(a)},rowById:function(a){return this._row(this._rowPositionById[a])},_row:function(a){var b={};return _.each(this._columns,function(c){b[c.name]=c.data[a]}),b},_remove:function(a){var b=this._rowPositionById[a];return _.each(this._columns,function(a){a.data.splice(b,1)}),delete this._rowPositionById[a],this._rowIdByPosition.splice(b,1),this.length--,this},_add:function(a,c){_.each(a,function(c,d){var e=this.column(d),f=b.types[e.type];if(f.test(a[e.name],e.typeOptions))a[e.name]=f.coerce(a[e.name],e.typeOptions);else throw"incorrect value '"+a[e.name]+"' of type "+b.typeOf(a[e.name],e.typeOptions)+" passed to column with type "+e.type},this);if(_.isUndefined(this.comparator))_.each(this._columns,function(b){b.data.push(a[b.name]?a[b.name]:null)}),this._rowIdByPosition.push(a._id),this._rowPositionById[a._id]=this._rowIdByPosition.length;else{var d=function(a,b,c){Array.prototype.splice.apply(c,[a,0].concat(b))},e;for(e=0;e<this.length;e++){var f=this.rowByPosition(e);if(this.comparator(a,f)<0){_.each(this._columns,function(b){d(e,a[b.name]?a[b.name]:null,b.data)});break}}this._rowIdByPosition=[],this._rowPositionById={},this.each(function(a,b){this._rowIdByPosition.push(a._id),this._rowPositionById[a._id]=b})}return this.length++,this},rows:function(a){return new b.View({filter:{rows:a},parent:this})},sort:function(a){a=a||{};if(_.isUndefined(this.comparator))throw new Error("Cannot sort without this.comparator.");var b=this.length,c;if(b===1)return;var d=_.bind(function(a,b){var c=this.rowByPosition(b);_.each(c,function(c,d){var e=this._columnPositionByName[d],f=this._columns[e].data[a];this._columns[e].data.splice(a,1,c),this._columns[e].data.splice(b,1,f)},this)},this),e=_.bind(function(a,b){var c=a,e;while(c*2<=b){e=c*2;var f=this.rowByPosition(c);e+1<b&&this.comparator(this.rowByPosition(e),this.rowByPosition(e+1))<0&&e++;if(this.comparator(f,this.rowByPosition(e))<0)d(c,e),c=e;else return}},this),f=function(a){var b=Math.round((a-2)/2);while(b>=0)e(b,a-1),b--};if(b>2){f(b),c=b-1;while(c>1)d(c,0),c--,e(0,c)}else this.comparator(this.rowByPosition(0),this.rowByPosition(1))>0&&d(0,1);this.syncable&&this.trigger("sort")}})}(this,_),function(a,_,moment){var b=a.Miso;b.Dataset=function(a){return a=a||(a={}),this._initialize(a),this},_.extend(b.Dataset.prototype,b.View.prototype,{_initialize:function(a){a.sync===!0&&(_.extend(this,b.Events),this.syncable=!0),this.importer=a.importer||null,this.parser=a.parser||b.Parsers.Obj,_.isUndefined(a.parser)&&(a.strict?this.parser=b.Parsers.Strict:a.delimiter?this.parser=b.Parsers.Delimited:a.google_spreadsheet&&(this.parser=b.Parsers.GoogleSpreadsheet));var c=_.extend({},a,{parser:this.parser});a.delimiter&&(c.dataType="text"),a.google_spreadsheet&&_.extend(c,a.google_spreadsheet),this.importer===null&&(a.url?this.importer=b.Importers.Remote:a.google_spreadsheet?(this.importer=b.Importers.GoogleSpreadsheet,delete a.google_spreadsheet):this.importer=b.Importers.Local),this.importer=new this.importer(c),a.comparator&&(this.comparator=a.comparator),a.ready&&(this.ready=a.ready),a.deferred&&(this.deferred=a.deferred)},fetch:function(a){a=a||{};var b=this.deferred||new _.Deferred;return this.importer!==null&&this.importer.fetch({success:_.bind(function(c){_.extend(this,c),this.comparator&&this.sort(),this.ready&&this.ready.call(this),a.success&&a.success.call(this),b.resolve(this)},this),error:_.bind(function(c){a.error&&a.error.call(this),b.reject(c)},this)}),b.promise()},add:function(a,b){a._id||(a._id=_.uniqueId()),this._add(a,b),this.syncable&&(!b||!b.silent)&&(this.trigger("add",this._buildEvent({changed:a})),this.trigger("change",this._buildEvent({changed:a})))},remove:function(a,b){a=this._rowFilter(a);var c=[];this.each(function(b,d){a(b)&&(this._remove(b._id),c.push({old:b}))});if(this.syncable&&(!b||!b.silent)){var d=this._buildEvent(c);this.trigger("change",d),this.trigger("remove",d)}},update:function(a,c,d){a=this._rowFilter(a);var e=_.keys(c),f=[];this.each(function(d,g){a(d)&&(_.each(this._columns,function(a){if(_.indexOf(e,a.name)!==-1){var d=b.types[a.type];if(d)if(b.typeOf(c[a.name],a.typeOptions)===a.type)c[a.name]=d.coerce(c[a.name],a.typeOptions);else throw"incorrect value '"+c[a.name]+"' of type "+b.typeOf(c[a.name],a.typeOptions)+" passed to column with type "+a.type;a.data[g]=c[a.name]}},this),f.push({_id:d._id,old:d,changed:c}))},this);if(this.syncable&&(!d||!d.silent)){var g=this._buildEvent(f);this.trigger("change",g),this.trigger("remove",g)}}})}(this,_,moment),function(a,_){var b=a.Miso,c=(b.Product||function(){return b.Product=function(a){a=a||(a={}),this.func=a.func;if(a.columns){var b=a.columns;_.isArray(a.columns)&&(b=a.columns[0]),this.valuetype=b.type,this.numeric=function(){return b.toNumeric(this.value)}}return this.func({silent:!0}),this},b.Product})();_.extend(c.prototype,b.Events,{sync:function(a){this.func()},val:function(){return this.value},type:function(){return this.valuetype},_buildDelta:function(a,b){return{old:a,changed:b}}}),_.extend(b.Dataset.prototype,{_findColumns:function(a){var b=[];return _.isUndefined(a)&&(a=this.columnNames()),a=_.isArray(a)?a:[a],_.each(a,function(a){a=this._columns[this._columnPositionByName[a]],b.push(a)},this),b},sum:function(a,b){b=b||{};var c=this._findColumns(a),d=function(a){return function(){return _.sum(_.map(a,function(a){return a.sum()}))}}(c);return this.calculated(c,d)},max:function(a,c){c=c||{};var d=this._findColumns(a),e=function(a){return function(){var c=_.max(_.map(a,function(a){return a.max()})),d=a[0].type,e=a[0].typeOptions;return b.types[d].coerce(c,e)}}(d);return this.calculated(d,e)},min:function(a,c){c=c||{};var d=this._findColumns(a),e=function(a){return function(){var c=_.min(_.map(a,function(a){return a.min()})),d=a[0].type,e=a[0].typeOptions;return b.types[d].coerce(c,e)}}(d);return this.calculated(d,e)},mean:function(a,c){c=c||{};var d=this._findColumns(a),e=function(a){return function(){var c=[];_.each(a,function(a){c.push(a.data)}),c=_.flatten(c);var d=a[0].type,e=a[0].typeOptions;return c=_.map(c,function(a){return b.types[d].numeric(a)}),b.types[d].coerce(_.mean(c),e)}}(d);return this.calculated(d,e)},median:function(a,b){},calculated:function(a,b){var d=this,e=new c({columns:a,func:function(a){a=a||{};var c=this._buildDelta(this.value,b.apply(d));this.value=c.changed;if(d.syncable){var e=this._buildEvent(c);!_.isUndefined(c.old)&&!a.silent&&c.old!==c.changed&&this.trigger("change",e)}}});return this.syncable?(this.bind("change",e.sync,e),e):b()}})}(this,_),function(a,_){var b=a.Miso=a.Miso||{};_.extend(a.Miso.Dataset.prototype,{movingAverage:function(a,b){},groupBy:function(a,c,d){d=d||{};var e=d.method||_.sum,f={_columns:[]};d&&d.preprocess&&(this.preprocess=d.preprocess);var g=new b.Parsers,h=_.union([a],c);_.each(h,function(a){var b=f._columns.push(_.clone(this._columns[this._columnPositionByName[a]]));f._columns[f._columns.length-1].data=[]},this),f=g._cacheColumns(f);var i={},j=0,k=f._columnPositionByName[a];for(var l=0;l<this.length;l++){var m=null;this.preprocess?m=this.preprocess(this._columns[this._columnPositionByName[a]].data[l]):m=this._columns[this._columnPositionByName[a]].data[l],_.isUndefined(i[m])&&(i[m]=j,_.each(c,function(a){var b=f._columns[f._columnPositionByName[a]];b.data[j]=[]}),f._columns[f._columnPositionByName[a]].data[j]=m,j++),_.each(c,function(a){var b=f._columns[f._columnPositionByName[a]],c=this._columns[this._columnPositionByName[a]].data[l],d=i[m];b.data[d].push(c)},this)}_.each(c,function(a){var b=f._columns[f._columnPositionByName[a]];_.each(b.data,function(a,c){_.isArray(a)&&(b.data[c]=e.call(this,a))})},this),f.columns=f._columns,delete f._columns;var n=new b.Dataset({data:f,strict:!0}),o=null;return n.fetch({success:function(){o=this}}),o}})}(this,_),function(a,_){var b=a.Miso||(a.Miso={});b.Parsers=function(){},_.extend(b.Parsers.prototype,{_buildColumn:function(a,c,d){return _.isObject(a)&&arguments.length===1?new b.Column(a):new b.Column({name:a,type:c,data:d})},build:function(a){var b={};return this._buildColumns(b),this._setTypes(b,this.options),this._detectTypes(b),this._coerceTypes(b),this._cacheColumns(b),this._cacheRows(b),b},_coerceTypes:function(a){return _.each(a._columns,function(a,b){a.coerce()}),a},_setTypes:function(a,b){b.columnTypes=b.columnTypes||{},_.each(a._columns,function(a){var c=b.columnTypes[a.name];c&&(_.isObject(c)?(a.type=c.type,delete c.type,a.typeOptions=c):a.type=c)})},_addValue:function(a,b,c){var d=a._columnPositionByName[b];a._columns[d].data.push(c)},_detectTypes:function(a,c){return _.each(a._columns,function(a){if(_.isUndefined(a.type)||a.type===null){var d=_.inject(a.data.slice(0,c||5),function(a,c){var d=b.typeOf(c);return c!==""&&a.indexOf(d)===-1&&!_.isNull(c)&&a.push(d),a},[]);if(d.length===1)a.type=d[0];else if(d.length===0)a.type="number";else throw new Error("This column seems to have mixed types")}}),a},_cacheColumns:function(a){return a._columnPositionByName={},_.each(a._columns,function(b,c){a._columnPositionByName[b.name]=c}),a},_cacheRows:function(a){a._rowPositionById={},a._rowIdByPosition=[],_.each(a._columns[a._columnPositionByName._id].data,function(b,c){a._rowPositionById[b]=c,a._rowIdByPosition.push(b)});var b=_.uniq(_.map(a._columns,function(a){return a.data.length}));if(b.length>1)throw new Error("Row lengths need to be the same. Empty values should be set to null."+_.map(a._columns,function(a){return a.data+"|||"}));return a.length=b[0],a},_addIdColumn:function(a,b){var c=[];return b&&b>0&&_.times(b,function(){c.push(_.uniqueId())}),a._columns.unshift(this._buildColumn("_id","number",c)),a},parse:function(a){return a}}),b.Parsers.Strict=function(a,b){this.options=b||{},this._data=this.parse(a)},_.extend(b.Parsers.Strict.prototype,b.Parsers.prototype,{_buildColumns:function(a){return a._columns=[],_.each(this._data._columns,function(b){a._columns.push(this._buildColumn(b))},this),_.pluck(a._columns,"name").indexOf("_id")===-1&&this._addIdColumn(a,a._columns[0].data.length),a}}),b.Parsers.Obj=function(a,b){this.options=b||{},this._data=a},_.extend(b.Parsers.Obj.prototype,b.Parsers.prototype,{_buildColumns:function(a,b){a._columns=[];var c=_.keys(this._data[0]);return _.each(c,function(b){a._columns.push(this._buildColumn(b,null))},this),this._addIdColumn(a),this._cacheColumns(a),_.map(this._data,function(b){_.each(b,function(b,c){this._addValue(a,c,b)},this),this._addValue(a,"_id",_.uniqueId())},this),a},build:function(a){var b={};return this._buildColumns(b),this._setTypes(b,this.options),this._detectTypes(b),this._coerceTypes(b),this._cacheRows(b),b}});var c={url:"",data:"",dataType:"",success:function(){},type:"GET",async:!0,xhr:function(){return new a.XMLHttpRequest}},d=/\?/;b.Xhr=function(a){a.dataType=a.dataType&&a.dataType.toLowerCase()||null;if(!(!a.dataType||a.dataType!=="jsonp"&&a.dataType!=="script")){b.Xhr.getJSONP(a.url,a.success,a.dataType==="script",a.error);return}var e=_.extend({},c,a);e.ajax=e.xhr();if(e.ajax)return e.type==="GET"&&e.data&&(e.url+=(d.test(e.url)?"&":"?")+e.data,e.data=null),e.ajax.open(e.type,e.url,e.async),e.ajax.send(e.data||null),b.Xhr.httpData(e)},b.Xhr.getJSONP=function(a,b,c,d){if(c){var e=document.querySelectorAll('script[src="'+a+'"]');if(e.length){b&&b(!0);return}}var f=document.head||document.getElementsByTagName("head")[0]||document.documentElement,g=document.createElement("script"),h=a.split("?")[1],i=!1,j=[],k,l,m;h&&!c&&(j=h.split("&")),j.length&&(l=j[j.length-1].split("=")),k=j.length?l[1]?l[1]:l[0]:"jsonp",!h&&!c&&(a+="?callback="+k),k&&!c&&(!window[k]||(k=k+ +(new Date)+_.uniqueId()),window[k]=function(a){b&&b(a),i=!0},a=a.replace(l.join("="),l[0]+"="+k)),g.onload=g.onreadystatechange=function(){if(!g.readyState||/loaded|complete/.test(g.readyState))c&&b&&b(),i&&(delete window[k],f.removeChild(g))},g.onerror=function(a){d&&d.call(null)},g.src=a,f.insertBefore(g,f.firstChild);return},b.Xhr.httpData=function(a){var b,c=null;return a.ajax.onreadystatechange=function(){if(a.ajax.readyState===4){try{c=JSON.parse(a.ajax.responseText)}catch(d){}b={xml:a.ajax.responseXML,text:a.ajax.responseText,json:c},a.dataType&&(b=b[a.dataType]),/(2..)/.test(a.ajax.status)?a.success.call(a.ajax,b):a.error&&a.error.call(null,a.ajax.statusText)}},b},b.Importers=function(a,b){},b.Importers.prototype.extract=function(a){return a=_.clone(a),a._columns=a.columns,delete a.columns,a},b.Importers.Local=function(a){this.options=a||(a={}),this.options.extract&&(this.extract=this.options.extract),this.data=a.data,this.parser=this.options.parser||b.Importer.Obj},_.extend(b.Importers.Local.prototype,b.Importers.prototype,{fetch:function(a){this.data=this.extract(this.data),this.parser=new this.parser(this.data,_.extend({},this.options,a));var b=this.parser.build();a.success(b)}}),b.Importers.Remote=function(a){a=a||{},this._url=a.url,a.extract&&(this.extract=a.extract),this.parser=a.parser||b.Parsers.Obj,this.params={type:"GET",url:this._url,dataType:a.dataType?a.dataType:a.jsonp?"jsonp":"json"}},_.extend(b.Importers.Remote.prototype,b.Importers.prototype,{fetch:function(a){var c=_.bind(function(b){b=this.extract(b),this.parser=new this.parser(b,a);var c=this.parser.build();a.success(c)},this);b.Xhr(_.extend(this.params,{success:c,error:a.error}))}})}(this,_),function(a,_){var b=a.Miso||(a.Miso={});b.Parsers.GoogleSpreadsheet=function(a,b){this.options=b||{},this._data=a},_.extend(b.Parsers.GoogleSpreadsheet.prototype,b.Parsers.prototype,{_buildColumns:function(a,b){a._columns=[];var c=/([A-Z]+)(\d+)/,d={};return _.each(this._data.feed.entry,function(b,e){var f=c.exec(b.title.$t),g=f[1],h=parseInt(f[2],10);if(_.isUndefined(d[g]))d[g]=a._columns.length,a._columns.push(this._buildColumn(b.content.$t,null,[]));else{var i=d[g];a._columns[i].data[h-1]=b.content.$t}},this),a.length=_.max(a._columns,function(a){return a.data.length}).data.length-1,_.each(a._columns,function(b,c){b.data.splice(0,1);for(var d=0;d<a.length;d++)if(_.isUndefined(b.data[d])||b.data[d]==="")b.data[d]=null}),_.pluck(a._columns,"name").indexOf("_id")===-1&&this._addIdColumn(a,a._columns[0].data.length),a}}),b.Importers.GoogleSpreadsheet=function(a){a=a||{};if(a.url)a.url=a.url;else{if(_.isUndefined(a.key))throw new Error("Set options.key to point to your google document.");a.worksheet=a.worksheet||1,a.url="https://spreadsheets.google.com/feeds/cells/"+a.key+"/"+a.worksheet+"/public/basic?alt=json-in-script&callback=",delete a.key,delete a.worksheet}return this.parser=b.Parsers.GoogleSpreadsheet,this.params={type:"GET",url:a.url,dataType:"jsonp"},this},_.extend(b.Importers.GoogleSpreadsheet.prototype,b.Importers.Remote.prototype)}(this,_),function(a,_){var b=a.Miso||(a.Miso={});b.Parsers.Delimited=function(a,b){this.options=b||{},this.delimiter=this.options.delimiter||",",this._data=a,this.__delimiterPatterns=new RegExp("(\\"+this.delimiter+"|\\r?\\n|\\r|^)"+'(?:"([^"]*(?:""[^"]*)*)"|'+'([^"\\'+this.delimiter+"\\r\\n]*))","gi")},_.extend(b.Parsers.Delimited.prototype,b.Parsers.prototype,{_buildColumns:function(a,b){a._columns=[];var c=function(b,c,e){e=e||",";var f=null,g=0,h=!1,i=-1;while(f=b.exec(c)){var j=f[1];j.length&&j!==e?(h=!0,i=0):(h||g++,i++);var k=null;f[2]?k=f[2].replace(new RegExp('""',"g"),'"'):k=f[3],h?a._columns[i].data.push(k):a._columns.push(this._buildColumn({name:k,data:[]}))}return a};return c=_.bind(c,this),c(this.__delimiterPatterns,this._data,this.delimiter),this._addIdColumn(a,a._columns[0].data.length),a}})}(this,_)